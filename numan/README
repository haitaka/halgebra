Raw sources from previous version. Need to adopt to new Halgebra lib.